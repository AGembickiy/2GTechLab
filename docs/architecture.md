## Архитектура платформы 3D‑печати

### 1. Монорепозиторий

Репозиторий логически делится на несколько подсистем:

- `web` — клиентское приложение для пользователей и административной панели.
- `api` — единый GraphQL‑backend, инкапсулирующий доменную логику.
- `infrastructure` — Docker‑окружение и манифесты Kubernetes.
- `docs` — архитектурная и техническая документация.

### 2. Backend (`api`)

- **HTTP‑слой**: Express.
- **API‑слой**: Apollo Server (GraphQL) с модульной схемой.
- **Модули домена** (`src/modules`):
  - `orders` — заказы и статусы.
  - `catalog` — товары, категории, отзывы.
  - `users` — пользователи, роли и права.
  - `printing` — модели, калькулятор стоимости печати.
  - `production` — производственные задания, очереди, планировщик.
  - `inventory` — материалы, склад, остатки.
  - `equipment` — принтеры и обслуживание.
  - `finance` — платежи, доходы/расходы, прибыльность.
  - `crm` — клиенты, лиды, сделки, обращения.
  - `integrations` — внешние сервисы (платежи, логистика, CRM/ERP, маркетплейсы).

- **Доступ к данным**:
  - PostgreSQL через ORM (Prisma) для основных сущностей.
  - MongoDB для логов и аналитики.
  - Redis для кэша (справочники, тяжёлые расчёты).

### 3. Frontend (`web`)

- Next.js (App Router) как фреймворк.
- Redux Toolkit как глобальное состояние.
- Основные функциональные области:
  - Клиентский интерфейс (калькулятор, магазин, личный кабинет, заказы, загрузка моделей).
  - Административная панель (управление заказами, производством, складом, финансами, оборудованием и CRM).
- UI‑слой:
  - Базовая дизайн‑система (кнопки, поля ввода, таблицы, модальные окна, уведомления).
  - Поддержка адаптивной вёрстки.

### 4. Инфраструктура (`infrastructure`)

- **Docker / docker-compose** — локальная разработка:
  - контейнеры для `api`, `web`, `postgres`, `mongo`, `redis`, `minio`.
- **Kubernetes**:
  - Deployment/Service/Ingress для `api` и `web`;
  - StatefulSet/Service для PostgreSQL и MongoDB (в проде при необходимости заменяются управляемыми сервисами).

### 5. Доменные границы

- Сервис `orders` отвечает за жизненный цикл заказа.
- Производственные задачи (`production`) связаны с заказами, принтерами и материалами.
- `inventory` определяет доступность материалов, но не знает деталей заказов.
- `finance` оперирует данными заказов, платежей и затрат для расчёта прибыльности.
- `crm` работает с клиентами и их активностью, опираясь на данные заказов и обращений.

Далее схема БД и типы GraphQL будут зафиксированы в отдельных документах и файлах проекта.

