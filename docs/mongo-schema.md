## MongoDB: коллекции и назначение

MongoDB используется для хранения неструктурированных и аналитических данных.

### 1. Логи событий (`events_log`)

- **Назначение**: аудит действий пользователей и системных событий.
- Пример документа:
  - `type`: `"USER_LOGIN" | "ORDER_STATUS_CHANGED" | ...`
  - `userId`: `string | null`
  - `payload`: произвольный объект с деталями.
  - `createdAt`: `Date`.

### 2. Логи расчётов и аналитика калькулятора (`pricing_calculations`)

- **Назначение**: хранение истории расчётов стоимости печати.
- Пример документа:
  - `modelFileId`: `string` (ссылка на `File3DModel` в PostgreSQL).
  - `materialCode`: `string`.
  - `params`: объект с параметрами (качество, плотность заполнения и т.п.).
  - `result`: объект с рассчитанной стоимостью и временем печати.
  - `createdAt`: `Date`.

### 3. Техническая аналитика производства (`production_metrics`)

- **Назначение**: метрики производственного процесса для последующей AI‑аналитики.
- Пример документа:
  - `jobId`: `string` (ссылка на `ProductionJob`).
  - `printerId`: `number`.
  - `actualDurationMinutes`: `number`.
  - `failures`: массив объектов с описанием ошибок.
  - `timestamps`: временные метки ключевых этапов.

### 4. Сырые отчёты и агрегаты (`analytics_snapshots`)

- **Назначение**: агрегированные срезы по продажам, загрузке оборудования, CRM‑воронкам.
- Пример документа:
  - `type`: `"REVENUE_DAILY" | "PRINTER_UTILIZATION" | "CRM_FUNNEL"` и т.п.
  - `period`: описание периода (дата/месяц/квартал).
  - `data`: агрегированные значения, подготовленные для дашбордов.

Структура коллекций может эволюционировать без миграций схемы, при этом ключевые идентификаторы (связи с PostgreSQL) остаются стабильными.

